<script>
  function startAnalysis() {
    const input = document.getElementById("question").value;
    const responseBox = document.getElementById("responseBox");
    responseBox.value = "⏳ Bekleniyor...";

    fetch("https://n8n.muratocak.net/webhook/alerion/analyze", {
      method: "POST",
      headers: {
        "Content-Type": "application/json"
      },
      body: JSON.stringify({
        coin: input,
        trigger: "analyze",
        origin: "AQUILA",
        command: `${input} ile ilgili tüm birimler çalışsın, rapor hazırlansın`
      })
    })
    .then(res => res.text())
    .then(data => {
      responseBox.value = "✅ Gönderildi: " + data;
    })
    .catch(err => {
      responseBox.value = "❌ Hata: " + err.message;
    });
  }

  function startVoiceRecognition() {
    const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
    recognition.lang = 'tr-TR';
    recognition.interimResults = false;
    recognition.maxAlternatives = 1;

    recognition.onresult = function(event) {
      const transcript = event.results[0][0].transcript;
      document.getElementById("question").value = transcript;
      startAnalysis();
    };

    recognition.onerror = function(event) {
      document.getElementById("responseBox").value = "❌ Mikrofon hatası: " + event.error;
    };

    recognition.start();
  }
</script>
